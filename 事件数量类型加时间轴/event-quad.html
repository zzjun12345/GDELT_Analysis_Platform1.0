<!DOCTYPE html>
<html style="height: 100%">
   <head>
       <meta charset="utf-8">
       <style>
           .selector {
               position: absolute;
               left: 10px;
               top:10px;
           }
       </style>
   </head>
   <body style="height: 100%; margin: 0">
       <div id="container" style="height: 100%"></div>
       <script src="echarts.min.js"></script>
        <script src="jquery-3.3.1.min.js"></script>
    <script type="text/javascript">
        var dateid=['20200325','20200326','20200327','20200328','20200329','20200330','20200331','20200401','20200402','20200403','20200404','20200405','20200406','20200407','20200408','20200409','20200410','20200411','20200412','20200413','20200414','20200415','20200416','20200417','20200418','20200419','20200420','20200421','20200422','20200423'];
        
        function getList(dateid) {
            var numberList=[];
            for(var i=0;i<eventdate.length;i++)
            {
                if(eventdate[i]==dateid)
                {
                    for(var j=0;j<20;j++) 
                    {
                        numberList.push(eventnumber[i+j])
                    }
                }
            }
            return numberList;
        }
        function getpie(dateid){
            var numberList = [];
            for(var i=0;i<quaddate.length;i++)
            {
                if(quaddate[i]==dateid)
                {
                    if(quadclass[i]=='1') numberList[0]=quadnumber[i];
                    if(quadclass[i]=='2') numberList[1]=quadnumber[i];
                    if(quadclass[i]=='3') numberList[2]=quadnumber[i];
                    if(quadclass[i]=='4') numberList[3]=quadnumber[i];
                }
            }
            return numberList;
        }
        var eventdate = [];
        var eventcode = [];
        var eventnumber = [];
        $.ajax({
            async:false,
            url: "event.json",//json文件位置，文件名
            type: "GET",//请求方式为get
            dataType: "json", //返回数据格式为json
            // traditional:true,
            success: function(data) {//请求成功完成后要执行的方法 
                for(var i=0;i<data.length;i++){
                    eventdate[i]=data[i].date;
                    eventcode[i]=data[i].eventcode;
                    eventnumber[i]=data[i].number;
                }
                
            }
        })
        var quaddate = [];
        var quadclass = [];
        var quadnumber = [];
        $.ajax({
            async:false,
            url: "quad.json",//json文件位置，文件名
            type: "GET",//请求方式为get
            dataType: "json", //返回数据格式为json
            // traditional:true,
            success: function(data) {//请求成功完成后要执行的方法 
                for(var i=0;i<data.length;i++){
                    quaddate[i]=data[i].date;
                    quadclass[i]=data[i].quadclass;
                    quadnumber[i]=data[i].number;
                }
                
            }
        })
        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var app={};
        var options=[];
        dateid.forEach(date=>{
            var pielist = getpie(date);
            options.push(
                {
                    series: [
                        {data: getList(date)},
                        {data:[
                            {value: pielist[0], name: '口头合作'},
                            {value: pielist[1], name: '物质合作'},
                            {value: pielist[2], name: '口头冲突'},
                            {value: pielist[3], name: '物质冲突'}
                        ]}
                    ]
                }
            )
        })
        console.log(options)
        
        option = {
            baseOption:{
                timeline: {
                    axisType: 'category',
                    // realtime: false,
                    // loop: false,
                    autoPlay: true,
                    // currentIndex: 2,
                    playInterval: 1000,
                    // controlStyle: {
                    //     position: 'left'
                    // },
                    data: ['0325','0326','0327','0328','0329','0330','0331','0401','0402','0403','0404','0405','0406','0407','0408','0409','0410','0411','0412','0413','0414','0415','0416','0417','0418','0419','0420','0421','0422','0423'],
                    label: {
                        formatter : function(s) {
                            return (new Date(s)).getFullYear();
                        }
                    }
                },
                
                tooltip: {
                },
                legend: {
                    left: 'right',
                    orient: 'vertical',
                    data: ['口头合作', '物质合作', '口头冲突', '物质冲突']
                },
                
                calculable : true,
                grid: {
                    top: 80,
                    bottom: 100,
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow',
                            label: {
                                show: true,
                                formatter: function (params) {
                                    return params.value.replace('\n', '');
                                }
                            }
                        }
                    }
                },
                xAxis: [
                    {
                        type: 'category',
                        data: ['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20'],
                        boundaryGap: true
                    }
                ],
                yAxis: [
                    {
                        type: 'value'
                    }
                ],
                series: [
                    {
                        name: 'number',
                        type: 'line',
                        barWidth: '50%',
                    },
                    {
                        name: 'quad',
                        type: 'pie',
                        center: ['75%', '35%'],
                        radius: '28%',
                        z: 100,
                        data: 
                        [
                            {value: 2342223, name: '口头合作'},
                            {value: 530682, name: '物质合作'},
                            {value: 431263, name: '口头冲突'},
                            {value: 430124, name: '物质冲突'}
                        ]
                    }
                ]
            },
            options:options
        };
        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }
       </script>
   </body>
</html>